---
/**
 * Photo gallery with CSS Grid masonry layout.
 *
 * Images are optimized to AVIF via getImage(), displayed in a dense grid
 * with nth-child span rules for visual rhythm, and linked to the custom
 * lightbox for fullscreen viewing with zoom/pan.
 *
 * Per-image focal point overrides (positionx/positiony) control
 * object-position for cropped thumbnails. Default is center 25%.
 */
import "../styles/MasonryLayout.css";
import { getImage } from "astro:assets";

export interface MasonryImage {
  src: string;
  alt: string;
  positionx?: string;
  positiony?: string;
}

export interface Props {
  images: Array<MasonryImage | null>;
}

const { images } = Astro.props;
const imageAssets = await Promise.all(
  images.map(async (image) => {
    if (image) {
      return await getImage({
        src: image.src,
        alt: image.alt,
        width: 1920,
        height: 1080,
        decoding: "async",
        format: "avif",
        loading: "lazy",
      });
    }
    return null;
  }),
);
---

<div class="masonry not-prose">
  {
    imageAssets.map((imageAsset, index) => {
      if (!imageAsset) return null;
      const image = images[index]!;
      const hasPosition = image.positionx || image.positiony;
      const posStyle = hasPosition
        ? `object-position: ${image.positionx ?? "center"} ${image.positiony ?? "center"}`
        : undefined;
      return (
        <div class="image-container" id="gallery">
          <a href={image.src} class="image-link glightbox">
            <img
              src={imageAsset.src}
              alt={imageAsset.attributes.alt}
              loading={imageAsset.attributes.loading}
              decoding={imageAsset.attributes.decoding}
              width={imageAsset.attributes.width}
              height={imageAsset.attributes.height}
              class="image"
              style={posStyle}
            />
          </a>
        </div>
      );
    })
  }
</div>
<script src="../scripts/lightbox.ts"></script>
